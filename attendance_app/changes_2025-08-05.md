# 코드 변경 내역 (2025-08-05)

## 🚀 주요 변경 사항

1.  **백엔드 알림 기능 추가**: Python 백엔드에서 프론트엔드로 메시지를 보내 모달창을 띄울 수 있습니다.
2.  **공지사항 상세 보기 및 댓글 기능**: 공지사항을 클릭하여 상세 내용과 댓글을 보고, 새로운 댓글을 작성할 수 있습니다.
3.  **댓글 작성자 이름 설정**: 최초 댓글 작성 시 사용자 이름을 입력받아 저장하고, 이후 자동으로 사용합니다.
4.  **휴일 자동 설정**: DB에 데이터가 없는 주말/공휴일은 기본 "휴일"로 처리합니다.

---

## 📄 변경된 파일

-   `app_access.py` (백엔드 로직 및 데이터베이스 관리)
-   `templates/index.html` (프론트엔드 UI 및 JavaScript 로직)
-   `static/style.css` (UI 스타일)

---

## ✨ 세부 변경 내역

### 1. `app_access.py` (백엔드)

#### 1.1. 데이터베이스 스키마 확장
`Comments`와 `Users` 테이블을 새로 추가하여 댓글과 사용자 정보를 저장할 수 있도록 `_create_tables` 함수를 수정했습니다.

```python
# In _create_tables method
self._execute("""
    CREATE TABLE Comments (
        ID AUTOINCREMENT PRIMARY KEY,
        AnnouncementID LONG,
        AuthorName TEXT(100),
        CommentText MEMO,
        CommentDate DATE
    );
""")
self._execute("""
    CREATE TABLE Users (
        EmployeeID TEXT(50) PRIMARY KEY,
        UserName TEXT(100)
    );
""")
```

#### 1.2. `DatabaseManager` 기능 추가
새로운 테이블을 관리하기 위한 함수들을 추가했습니다.
-   `get_user_name`, `set_user_name`
-   `get_announcement_details`
-   `add_comment`

#### 1.3. `Backend` 클래스 기능 확장
프론트엔드와 통신하기 위한 새로운 Signal과 Slot을 추가하고 로직을 구현했습니다.

-   **Signals 추가**:
    ```python
    showAlert = Signal(str)
    announcementDetailsLoaded = Signal(dict)
    userNameRequired = Signal()
    ```
-   **Slots 추가**:
    ```python
    @Slot(int)
    def getAnnouncementDetails(self, announcement_id):
        # ...

    @Slot(str)
    def setUserName(self, user_name):
        # ...

    @Slot(int, str)
    def addComment(self, announcement_id, comment_text):
        # ...
    ```
-   **사용자 이름 로직**: `setEmployeeId` 시 DB에서 사용자 이름을 가져와 `self.user_name`에 저장합니다.
-   **휴일 자동 설정**: `load_and_emit_employee_data` 함수에서 DB에 데이터가 없는 주말/공휴일을 "休日"로 자동 설정합니다.

### 2. `index.html` (프론트엔드)

#### 2.1. 신규 모달 UI 추가
-   **사용자 이름 입력 모달** (`user-name-modal`)
-   **알림 모달** (`alert-modal`)
-   **공지사항 상세/댓글 모달** (`announcement-detail-modal`)

#### 2.2. JavaScript 로직 대폭 수정
-   **Signal 핸들러 추가**: 백엔드에서 오는 `showAlert`, `announcementDetailsLoaded`, `userNameRequired` 신호를 받아 각각의 모달을 제어하는 함수를 추가했습니다.
-   **공지사항 클릭 이벤트**: 공지사항 목록의 각 항목을 클릭하면 백엔드로 상세 정보를 요청(`getAnnouncementDetails`)합니다.
-   **댓글 작성 로직**: 댓글 전송 버튼 클릭 시, `user_name` 변수의 유무를 확인하여 이름이 없으면 백엔드에 확인을 요청하고, `userNameRequired` 신호를 받으면 이름 입력 모달을 띄웁니다.
-   **전체적인 코드 구조 개선**: 함수 분리, 이벤트 바인딩 로직 개선 등 가독성과 유지보수성을 향상시켰습니다.

### 3. `style.css` (스타일시트)

새로 추가된 모달창과 댓글 UI 요소들에 대한 CSS 스타일을 추가하여 일관된 디자인을 유지했습니다.

```css
.modal-content.wide { max-width: 800px; }
.modal-scroll-content { max-height: 300px; overflow-y: auto; /* ... */ }
.announcement-item { /* ... */ cursor: pointer; }
.comment { /* ... */ }
```
